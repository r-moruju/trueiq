<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <title>BrainPulseIQ ‚Äì Detailed Breakdown</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>

<body class="bg-gray-50 min-h-screen flex flex-col justify-between">

  <!-- Header -->
  <header class="bg-white shadow sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex justify-between items-center h-16">
      <a href="index.html" class="flex items-center">
        <img src="logo.png" alt="BrainPulseIQ Logo" class="h-20 w-auto" />
      </a>
      <nav class="hidden md:flex space-x-6 text-gray-700">
        <a href="index.html" class="hover:text-indigo-600">Home</a>
        <a href="test.html" class="hover:text-indigo-600">Take the Test</a>
        <a href="results.html" class="hover:text-indigo-600">Results</a>
        <a href="about.html" class="hover:text-indigo-600">About</a>
      </nav>
      <div class="md:hidden">
        <button id="menuToggle" class="text-gray-700 focus:outline-none">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
    <div id="mobileMenu" class="md:hidden hidden px-4 pb-4 bg-white border-t border-gray-200">
      <a href="index.html" class="block py-2 text-gray-700 hover:text-indigo-600">Home</a>
      <a href="test.html" class="block py-2 text-gray-700 hover:text-indigo-600">Take the Test</a>
      <a href="results.html" class="block py-2 text-gray-700 hover:text-indigo-600">Results</a>
      <a href="about.html" class="block py-2 text-gray-700 hover:text-indigo-600">About</a>
    </div>
  </header>

  <!-- Main Content -->
  <main class="flex-grow flex items-center justify-center p-8">
    <div class="bg-white shadow-xl rounded-lg p-6 w-full max-w-2xl">
      <h1 class="text-3xl font-bold text-indigo-700 mb-4 text-center">Your IQ Breakdown</h1>
      <p class="text-center text-gray-600 mb-6">Based on your performance across different categories</p>

      <canvas id="categoryChart" class="mb-6"></canvas>
      <!-- Insights Section -->
      <div id="insightsSection" class="mt-10 hidden">
        <h2 class="text-2xl font-bold text-indigo-700 mb-4 text-center">üß† Personal Insights</h2>
        <div id="insightsContent" class="space-y-6 text-gray-700 text-base"></div>
      </div>
      <div id="feedback" class="text-center text-lg text-gray-700 mb-4"></div>

      <div class="border-t border-gray-200 pt-4 mt-6">
        <h2 class="text-xl font-semibold mb-2 text-center">üéì Get Your Certificate</h2>
        <div class="flex flex-col items-center gap-2">
          <input type="text" id="userName" placeholder="Enter your full name"
            class="border p-2 rounded w-full max-w-sm" />
          <input type="email" id="userEmail" placeholder="Enter your email"
            class="border p-2 rounded w-full max-w-sm" />
          <button onclick="generateCertificate()" class="bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700">
            üìÑ Download Certificate
          </button>
        </div>
      </div>
      <div class="mt-8 text-center">
        <p class="text-sm text-gray-500 mb-3">Share your score:</p>
        <div class="flex justify-center gap-4">
          <button onclick="shareToTwitter()" class="p-3 rounded-full bg-blue-500 hover:bg-blue-600 text-white">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M23 3a10.9 10.9 0 01-3.14 1.53 4.48 4.48 0 00-7.86 3v1A10.66 10.66 0 013 4s-4 9 5 13a11.64 11.64 0 01-7 2c9 5 20 0 20-11.5a4.5 4.5 0 00-.08-.83A7.72 7.72 0 0023 3z" />
            </svg>
          </button>

          <a id="facebookShare" href="#" target="_blank"
            class="bg-blue-600 text-white p-3 rounded-full flex items-center gap-2 justify-center w-full md:w-auto">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M22 12a10 10 0 10-11.5 9.87v-7h-2v-3h2v-2.3c0-2 1.2-3.1 3-3.1.9 0 1.8.16 1.8.16v2h-1c-1 0-1.3.6-1.3 1.2V12h2.3l-.4 3h-1.9v7A10 10 0 0022 12z" />
            </svg>
          </a>

          <button onclick="shareViaWeb()" class="p-3 rounded-full bg-gray-700 hover:bg-gray-800 text-white">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M18 8a6 6 0 00-9.33-5H6a4 4 0 000 8h1v2H6a6 6 0 110-12h2.67A8 8 0 1120 12a8 8 0 01-2 5.2V14a6 6 0 000-6z" />
            </svg>
          </button>
        </div>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-gray-100 py-6 text-center text-sm text-gray-600">
    <p>¬© 2025 BrainPulseIQ. All rights reserved.</p>
    <p><a href="mailto:contact@brainpulseiq.com" class="text-indigo-600 hover:underline">contact@brainpulsiq.com</a></p>
  </footer>

  <!-- Script -->
  <script>

    localStorage.setItem("hasPaid", "true");

    document.getElementById("menuToggle").addEventListener("click", () => {
      const menu = document.getElementById("mobileMenu");
      menu.classList.toggle("hidden");
    });

    const rawData = localStorage.getItem("categoryScores");
    const data = rawData ? JSON.parse(rawData) : {};
    const labels = Object.keys(data);
    const values = Object.values(data);

    const ctx = document.getElementById("categoryChart").getContext("2d");
    new Chart(ctx, {
      type: "bar",
      data: {
        labels: labels,
        datasets: [{
          label: "Correct Answers by Category",
          data: values,
          backgroundColor: "#6366f1"
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            ticks: { stepSize: 1 }
          }
        }
      }
    });

    // Insights content per category
    const insightsMap = {
      Verbal: {
        title: "Verbal Reasoning",
        description: "You excel at language and comprehension. Consider activities like reading, debates, or vocabulary games to sharpen these skills.",
        type: "The Communicator"
      },
      Logic: {
        title: "Logical Reasoning",
        description: "You are great at identifying patterns and making deductions. You might enjoy chess, puzzles, or programming challenges.",
        type: "The Analyst"
      },
      Math: {
        title: "Mathematical Reasoning",
        description: "You have strong numerical and problem-solving skills. Consider math games, finance puzzles, or coding.",
        type: "The Problem Solver"
      },
      Pattern: {
        title: "Pattern Recognition",
        description: "Your brain spots trends and sequences quickly. Explore cryptography, data analysis, or strategy games.",
        type: "The Strategist"
      },
      Visual: {
        title: "Visual-Spatial Thinking",
        description: "You process images and shapes effectively. Great for design, architecture, or visual arts.",
        type: "The Visual Thinker"
      },
      General: {
        title: "General Knowledge",
        description: "You have a good breadth of knowledge. Trivia, reading widely, and curiosity-driven learning will benefit you.",
        type: "The Explorer"
      }
    };

    function showInsights(maxCategory) {
      const container = document.getElementById("insightsSection");
      const content = document.getElementById("insightsContent");
      content.innerHTML = "";

      const insight = insightsMap[maxCategory];
      if (insight) {
        const card = document.createElement("div");
        card.className = "bg-white border border-gray-200 p-5 rounded-xl shadow-md";
        card.innerHTML = `
      <h3 class="text-lg font-semibold text-purple-700 mb-1">${insight.title} ‚Äì <span class="italic text-gray-600">${insight.type}</span></h3>
      <p>${insight.description}</p>
    `;
        content.appendChild(card);
        container.classList.remove("hidden");
      }
    }

    const maxCategory = labels[values.indexOf(Math.max(...values))];
    document.getElementById("feedback").textContent = `üß† Your strongest area was: ${maxCategory}`;
    // Call the updated function with maxCategory
    showInsights(maxCategory);

    async function generateCertificate() {
      const { jsPDF } = window.jspdf;
      const name = document.getElementById("userName").value.trim();
      const email = document.getElementById("userEmail").value.trim();
      const score = parseInt(localStorage.getItem("iqScore") || "0");
      const time = parseInt(localStorage.getItem("totalTimeTaken") || "0");
      const iq = parseInt(localStorage.getItem("realIQ") || "100");
      const date = new Date().toLocaleDateString();

      if (!name || !email) {
        alert("Please fill in name and email.");
        return;
      }

      // New fech
      const formData = new URLSearchParams();
      formData.append("name", name);
      formData.append("email", email);
      formData.append("score", score);
      formData.append("iq", iq);

      fetch("https://script.google.com/macros/s/AKfycby-W1HMMdcKLkqk5ZC4grEsEfMza1NSkh26uwiiRj5nEQ_AlgmswiyaMaBD440W8moOUg/exec", {
        method: "POST",
        body: formData
      })
        .then(res => res.text())
        .then(result => console.log("‚úÖ Saved to Google Sheet:", result))
        .catch(err => console.error("‚ùå Failed to save:", err));

      const doc = new jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: [210, 210]
      });

      const background = new Image();
      background.src = "certificate_bg.png"; // Replace with correct filename/path

      background.onload = function () {
        doc.addImage(background, "PNG", 0, 0, 210, 210); // Full A4 landscape

        doc.setFont("times", "bold");
        doc.setFontSize(24);
        doc.setTextColor(33, 60, 130);
        doc.text(name, 105, 110, { align: "center" }); // Centered on page

        doc.setFontSize(17);
        doc.setFont("helvetica", "bold");
        doc.setTextColor(0, 0, 0);
        doc.text(` ${score}/15`, 120, 143, { align: "center" });
        doc.text(` ${iq}`, 124, 153, { align: "center" });
        doc.text(` ${date}`, 126, 163, { align: "center" });

        doc.save(name.replace(/\s+/g, "_") + "_BrainPulseIQ_Certificate.pdf");
      };
    }
    function shareToTwitter() {
      const iq = localStorage.getItem("realIQ");
      const score = localStorage.getItem("iqScore");
      const text = `I just scored an IQ of ${iq} on BrainPulseIQ! üß† ${score}/15 correct. Think you‚Äôre smarter? üëâ`;
      const url = encodeURIComponent("https://brainpulseiq.com");
      const tweet = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${url}`;
      window.open(tweet, "_blank");
    }
    // Fcebook custumize link
    const fbIQ = parseInt(localStorage.getItem("realIQ") || "100");
    const facebookBtn = document.getElementById("facebookShare");
    if (facebookBtn && fbIQ) {
      const shareText = `I just scored ${fbIQ} on BrainPulseIQ! üß† Can you beat me?`;
      const shareUrl = `https://www.facebook.com/sharer/sharer.php?u=https://brainpulseiq.com&quote=${encodeURIComponent(shareText)}`;
      facebookBtn.setAttribute("href", shareUrl);
    }

    // function shareToFacebook() {
    //   const url = encodeURIComponent("https://brainpulseiq.com");
    //   const fb = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
    //   window.open(fb, "_blank");
    // }

    function shareViaWeb() {
      const iq = localStorage.getItem("realIQ");
      const score = localStorage.getItem("iqScore");
      const shareData = {
        title: "My BrainPulseIQ Score",
        text: `üß† I got an IQ of ${iq} on BrainPulseIQ ‚Äì ${score}/15 correct! Try it yourself:`,
        url: "https://brainpulseiq.com"
      };

      if (navigator.share) {
        navigator.share(shareData)
          .then(() => console.log("Shared successfully"))
          .catch(err => console.error("Share failed:", err));
      } else {
        alert("Sharing not supported on this browser.");
      }
    }
  </script>
</body>

</html>